// This file was auto-generated by Fern from our API Definition.

import * as KardApi from "../../src/api/index";
import { KardApiClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("BillingAgentClient", () => {
    test("createIssuerReward (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            transactionIds: ["billing.TransactionId.Sample"],
            description: "Reward payout for transaction",
        };
        const rawResponseBody = {
            data: {
                rewardId: "abd6e578-d130-44e6-bf4b-8dddb31038b0",
                transactionIds: ["5e27318c9b346f00087fbb32"],
                issuerId: "6e21318c9b346f12387ffe73",
                merchantId: "6e21318c9b346f12387ffe73",
                offerId: "6e21318c9b346f12387ffe73",
                userId: "6e21318c9b346f12387ffe73",
                transactionAmount: 3000,
                transactionTimestamp: "2024-10-01T01:23:45.67Z",
                issuerAmount: 100,
                cardHolderAmount: 400,
                kardFees: 50,
                createdDate: "2024-10-01T00:00:00Z",
                lastModified: "2024-10-02T00:00:00Z",
                entries: [
                    {
                        issuerAmount: 150,
                        cardHolderAmount: 500,
                        kardFees: 50,
                        description: "Reward payout for transaction",
                        type: "MATCHED",
                        createdAt: "2024-10-01T00:00:00Z",
                    },
                    {
                        issuerAmount: -50,
                        cardHolderAmount: -100,
                        kardFees: 0,
                        description: "Value adjusted upon request of issuer",
                        type: "ADJUSTMENT",
                        createdAt: "2024-10-02T00:00:00Z",
                    },
                ],
            },
        };
        server
            .mockEndpoint()
            .post("/internal/issuers/5e27318c9b346f00087fbb32/users/5e27318c9b346f00087fbb32/billing/rewards")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.billingAgent.createIssuerReward(
            "5e27318c9b346f00087fbb32",
            "5e27318c9b346f00087fbb32",
            {
                transactionIds: ["billing.TransactionId.Sample"],
                description: "Reward payout for transaction",
            },
        );
        expect(response).toEqual({
            data: {
                rewardId: "abd6e578-d130-44e6-bf4b-8dddb31038b0",
                transactionIds: ["5e27318c9b346f00087fbb32"],
                issuerId: "6e21318c9b346f12387ffe73",
                merchantId: "6e21318c9b346f12387ffe73",
                offerId: "6e21318c9b346f12387ffe73",
                userId: "6e21318c9b346f12387ffe73",
                transactionAmount: 3000,
                transactionTimestamp: "2024-10-01T01:23:45.67Z",
                issuerAmount: 100,
                cardHolderAmount: 400,
                kardFees: 50,
                createdDate: "2024-10-01T00:00:00Z",
                lastModified: "2024-10-02T00:00:00Z",
                entries: [
                    {
                        issuerAmount: 150,
                        cardHolderAmount: 500,
                        kardFees: 50,
                        description: "Reward payout for transaction",
                        type: "MATCHED",
                        createdAt: "2024-10-01T00:00:00Z",
                    },
                    {
                        issuerAmount: -50,
                        cardHolderAmount: -100,
                        kardFees: 0,
                        description: "Value adjusted upon request of issuer",
                        type: "ADJUSTMENT",
                        createdAt: "2024-10-02T00:00:00Z",
                    },
                ],
            },
        });
    });

    test("createIssuerReward (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { transactionIds: ["transactionIds", "transactionIds"], description: "description" };
        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .post("/internal/issuers/issuerId/users/userId/billing/rewards")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.createIssuerReward("issuerId", "userId", {
                transactionIds: ["transactionIds", "transactionIds"],
                description: "description",
            });
        }).rejects.toThrow(KardApi.UnauthorizedError);
    });

    test("createIssuerReward (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { transactionIds: ["transactionIds", "transactionIds"], description: "description" };
        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .post("/internal/issuers/issuerId/users/userId/billing/rewards")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.createIssuerReward("issuerId", "userId", {
                transactionIds: ["transactionIds", "transactionIds"],
                description: "description",
            });
        }).rejects.toThrow(KardApi.InternalServerError);
    });

    test("createIssuerReward (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { transactionIds: ["transactionIds", "transactionIds"], description: "description" };
        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .post("/internal/issuers/issuerId/users/userId/billing/rewards")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.createIssuerReward("issuerId", "userId", {
                transactionIds: ["transactionIds", "transactionIds"],
                description: "description",
            });
        }).rejects.toThrow(KardApi.InvalidRequest);
    });

    test("revertIssuerReward (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            data: {
                rewardId: "abd6e578-d130-44e6-bf4b-8dddb31038b0",
                transactionIds: ["5e27318c9b346f00087fbb32"],
                issuerId: "6e21318c9b346f12387ffe73",
                merchantId: "6e21318c9b346f12387ffe73",
                offerId: "6e21318c9b346f12387ffe73",
                userId: "6e21318c9b346f12387ffe73",
                transactionAmount: 3000,
                transactionTimestamp: "2024-10-01T01:23:45.67Z",
                issuerAmount: 100,
                cardHolderAmount: 400,
                kardFees: 50,
                createdDate: "2024-10-01T00:00:00Z",
                lastModified: "2024-10-02T00:00:00Z",
                entries: [
                    {
                        issuerAmount: 150,
                        cardHolderAmount: 500,
                        kardFees: 50,
                        description: "Reward payout for transaction",
                        type: "MATCHED",
                        createdAt: "2024-10-01T00:00:00Z",
                    },
                    {
                        issuerAmount: -50,
                        cardHolderAmount: -100,
                        kardFees: 0,
                        description: "Value adjusted upon request of issuer",
                        type: "ADJUSTMENT",
                        createdAt: "2024-10-02T00:00:00Z",
                    },
                ],
            },
        };
        server
            .mockEndpoint()
            .delete(
                "/internal/issuers/5e27318c9b346f00087fbb32/users/5e27318c9b346f00087fbb32/billing/rewards/82ed6e40-f2f6-4f66-be17-52c03ad64414",
            )
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.billingAgent.revertIssuerReward(
            "5e27318c9b346f00087fbb32",
            "5e27318c9b346f00087fbb32",
            "82ed6e40-f2f6-4f66-be17-52c03ad64414",
        );
        expect(response).toEqual({
            data: {
                rewardId: "abd6e578-d130-44e6-bf4b-8dddb31038b0",
                transactionIds: ["5e27318c9b346f00087fbb32"],
                issuerId: "6e21318c9b346f12387ffe73",
                merchantId: "6e21318c9b346f12387ffe73",
                offerId: "6e21318c9b346f12387ffe73",
                userId: "6e21318c9b346f12387ffe73",
                transactionAmount: 3000,
                transactionTimestamp: "2024-10-01T01:23:45.67Z",
                issuerAmount: 100,
                cardHolderAmount: 400,
                kardFees: 50,
                createdDate: "2024-10-01T00:00:00Z",
                lastModified: "2024-10-02T00:00:00Z",
                entries: [
                    {
                        issuerAmount: 150,
                        cardHolderAmount: 500,
                        kardFees: 50,
                        description: "Reward payout for transaction",
                        type: "MATCHED",
                        createdAt: "2024-10-01T00:00:00Z",
                    },
                    {
                        issuerAmount: -50,
                        cardHolderAmount: -100,
                        kardFees: 0,
                        description: "Value adjusted upon request of issuer",
                        type: "ADJUSTMENT",
                        createdAt: "2024-10-02T00:00:00Z",
                    },
                ],
            },
        });
    });

    test("revertIssuerReward (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .delete("/internal/issuers/issuerId/users/userId/billing/rewards/d5e9c84f-c2b2-4bf4-b4b0-7ffd7a9ffc32")
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.revertIssuerReward(
                "issuerId",
                "userId",
                "d5e9c84f-c2b2-4bf4-b4b0-7ffd7a9ffc32",
            );
        }).rejects.toThrow(KardApi.UnauthorizedError);
    });

    test("revertIssuerReward (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .delete("/internal/issuers/issuerId/users/userId/billing/rewards/d5e9c84f-c2b2-4bf4-b4b0-7ffd7a9ffc32")
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.revertIssuerReward(
                "issuerId",
                "userId",
                "d5e9c84f-c2b2-4bf4-b4b0-7ffd7a9ffc32",
            );
        }).rejects.toThrow(KardApi.InternalServerError);
    });

    test("revertIssuerReward (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .delete("/internal/issuers/issuerId/users/userId/billing/rewards/d5e9c84f-c2b2-4bf4-b4b0-7ffd7a9ffc32")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.revertIssuerReward(
                "issuerId",
                "userId",
                "d5e9c84f-c2b2-4bf4-b4b0-7ffd7a9ffc32",
            );
        }).rejects.toThrow(KardApi.DoesNotExistError);
    });

    test("getIssuerReward (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            data: {
                rewardId: "abd6e578-d130-44e6-bf4b-8dddb31038b0",
                transactionIds: ["5e27318c9b346f00087fbb32"],
                issuerId: "6e21318c9b346f12387ffe73",
                merchantId: "6e21318c9b346f12387ffe73",
                offerId: "6e21318c9b346f12387ffe73",
                userId: "6e21318c9b346f12387ffe73",
                transactionAmount: 3000,
                transactionTimestamp: "2024-10-01T01:23:45.67Z",
                issuerAmount: 100,
                cardHolderAmount: 400,
                kardFees: 50,
                createdDate: "2024-10-01T00:00:00Z",
                lastModified: "2024-10-02T00:00:00Z",
                entries: [
                    {
                        issuerAmount: 150,
                        cardHolderAmount: 500,
                        kardFees: 50,
                        description: "Reward payout for transaction",
                        type: "MATCHED",
                        createdAt: "2024-10-01T00:00:00Z",
                    },
                    {
                        issuerAmount: -50,
                        cardHolderAmount: -100,
                        kardFees: 0,
                        description: "Value adjusted upon request of issuer",
                        type: "ADJUSTMENT",
                        createdAt: "2024-10-02T00:00:00Z",
                    },
                ],
            },
        };
        server
            .mockEndpoint()
            .get(
                "/internal/issuers/5e27318c9b346f00087fbb32/users/5e27318c9b346f00087fbb32/billing/rewards/82ed6e40-f2f6-4f66-be17-52c03ad64414",
            )
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.billingAgent.getIssuerReward(
            "5e27318c9b346f00087fbb32",
            "5e27318c9b346f00087fbb32",
            "82ed6e40-f2f6-4f66-be17-52c03ad64414",
        );
        expect(response).toEqual({
            data: {
                rewardId: "abd6e578-d130-44e6-bf4b-8dddb31038b0",
                transactionIds: ["5e27318c9b346f00087fbb32"],
                issuerId: "6e21318c9b346f12387ffe73",
                merchantId: "6e21318c9b346f12387ffe73",
                offerId: "6e21318c9b346f12387ffe73",
                userId: "6e21318c9b346f12387ffe73",
                transactionAmount: 3000,
                transactionTimestamp: "2024-10-01T01:23:45.67Z",
                issuerAmount: 100,
                cardHolderAmount: 400,
                kardFees: 50,
                createdDate: "2024-10-01T00:00:00Z",
                lastModified: "2024-10-02T00:00:00Z",
                entries: [
                    {
                        issuerAmount: 150,
                        cardHolderAmount: 500,
                        kardFees: 50,
                        description: "Reward payout for transaction",
                        type: "MATCHED",
                        createdAt: "2024-10-01T00:00:00Z",
                    },
                    {
                        issuerAmount: -50,
                        cardHolderAmount: -100,
                        kardFees: 0,
                        description: "Value adjusted upon request of issuer",
                        type: "ADJUSTMENT",
                        createdAt: "2024-10-02T00:00:00Z",
                    },
                ],
            },
        });
    });

    test("getIssuerReward (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/internal/issuers/issuerId/users/userId/billing/rewards/d5e9c84f-c2b2-4bf4-b4b0-7ffd7a9ffc32")
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.getIssuerReward(
                "issuerId",
                "userId",
                "d5e9c84f-c2b2-4bf4-b4b0-7ffd7a9ffc32",
            );
        }).rejects.toThrow(KardApi.UnauthorizedError);
    });

    test("getIssuerReward (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/internal/issuers/issuerId/users/userId/billing/rewards/d5e9c84f-c2b2-4bf4-b4b0-7ffd7a9ffc32")
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.getIssuerReward(
                "issuerId",
                "userId",
                "d5e9c84f-c2b2-4bf4-b4b0-7ffd7a9ffc32",
            );
        }).rejects.toThrow(KardApi.InternalServerError);
    });

    test("getIssuerReward (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/internal/issuers/issuerId/users/userId/billing/rewards/d5e9c84f-c2b2-4bf4-b4b0-7ffd7a9ffc32")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.getIssuerReward(
                "issuerId",
                "userId",
                "d5e9c84f-c2b2-4bf4-b4b0-7ffd7a9ffc32",
            );
        }).rejects.toThrow(KardApi.DoesNotExistError);
    });

    test("getIssuerRewards (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            data: [
                {
                    rewardId: "abd6e578-d130-44e6-bf4b-8dddb31038b0",
                    transactionIds: ["5e27318c9b346f00087fbb32"],
                    issuerId: "6e21318c9b346f12387ffe73",
                    merchantId: "6e21318c9b346f12387ffe73",
                    offerId: "6e21318c9b346f12387ffe73",
                    userId: "6e21318c9b346f12387ffe73",
                    transactionAmount: 3000,
                    transactionTimestamp: "2024-10-01T01:23:45.67Z",
                    issuerAmount: 100,
                    cardHolderAmount: 400,
                    kardFees: 50,
                    createdDate: "2024-10-01T00:00:00Z",
                    lastModified: "2024-10-02T00:00:00Z",
                    entries: [
                        {
                            issuerAmount: 150,
                            cardHolderAmount: 500,
                            kardFees: 50,
                            description: "Reward payout for transaction",
                            type: "MATCHED",
                            createdAt: "2024-10-01T00:00:00Z",
                        },
                        {
                            issuerAmount: -50,
                            cardHolderAmount: -100,
                            kardFees: 0,
                            description: "Value adjusted upon request of issuer",
                            type: "ADJUSTMENT",
                            createdAt: "2024-10-02T00:00:00Z",
                        },
                    ],
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/internal/issuers/5e27318c9b346f00087fbb32/users/5e27318c9b346f00087fbb32/billing/rewards")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.billingAgent.getIssuerRewards(
            "5e27318c9b346f00087fbb32",
            "5e27318c9b346f00087fbb32",
        );
        expect(response).toEqual({
            data: [
                {
                    rewardId: "abd6e578-d130-44e6-bf4b-8dddb31038b0",
                    transactionIds: ["5e27318c9b346f00087fbb32"],
                    issuerId: "6e21318c9b346f12387ffe73",
                    merchantId: "6e21318c9b346f12387ffe73",
                    offerId: "6e21318c9b346f12387ffe73",
                    userId: "6e21318c9b346f12387ffe73",
                    transactionAmount: 3000,
                    transactionTimestamp: "2024-10-01T01:23:45.67Z",
                    issuerAmount: 100,
                    cardHolderAmount: 400,
                    kardFees: 50,
                    createdDate: "2024-10-01T00:00:00Z",
                    lastModified: "2024-10-02T00:00:00Z",
                    entries: [
                        {
                            issuerAmount: 150,
                            cardHolderAmount: 500,
                            kardFees: 50,
                            description: "Reward payout for transaction",
                            type: "MATCHED",
                            createdAt: "2024-10-01T00:00:00Z",
                        },
                        {
                            issuerAmount: -50,
                            cardHolderAmount: -100,
                            kardFees: 0,
                            description: "Value adjusted upon request of issuer",
                            type: "ADJUSTMENT",
                            createdAt: "2024-10-02T00:00:00Z",
                        },
                    ],
                },
            ],
        });
    });

    test("getIssuerRewards (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/internal/issuers/issuerId/users/userId/billing/rewards")
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.getIssuerRewards("issuerId", "userId");
        }).rejects.toThrow(KardApi.UnauthorizedError);
    });

    test("getIssuerRewards (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/internal/issuers/issuerId/users/userId/billing/rewards")
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.getIssuerRewards("issuerId", "userId");
        }).rejects.toThrow(KardApi.InternalServerError);
    });

    test("getIssuerRewards (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/internal/issuers/issuerId/users/userId/billing/rewards")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.getIssuerRewards("issuerId", "userId");
        }).rejects.toThrow(KardApi.DoesNotExistError);
    });

    test("getIssuerMatchedTransactionInfo (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            data: {
                "12345": {
                    timestamp: "2024-10-01T01:23:45Z",
                    amount: 1000,
                    merchantId: "6e21318c9b346f12387ffe73",
                    merchantNetwork: "REWARDSNETWORK",
                    offerId: "6e21318c9b346f12387ffe73",
                    commissionToIssuer: 121,
                    receivedCommissionInCents: 60,
                    usersCommissionInCents: 100,
                },
            },
        };
        server
            .mockEndpoint()
            .get("/internal/issuers/5e27318c9b346f00087fbb32/users/5e27318c9b346f00087fbb32/billing/util/transactions")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.billingAgent.getIssuerMatchedTransactionInfo(
            "5e27318c9b346f00087fbb32",
            "5e27318c9b346f00087fbb32",
            {
                transactionIds: "123456,876543",
            },
        );
        expect(response).toEqual({
            data: {
                "12345": {
                    timestamp: "2024-10-01T01:23:45Z",
                    amount: 1000,
                    merchantId: "6e21318c9b346f12387ffe73",
                    merchantNetwork: "REWARDSNETWORK",
                    offerId: "6e21318c9b346f12387ffe73",
                    commissionToIssuer: 121,
                    receivedCommissionInCents: 60,
                    usersCommissionInCents: 100,
                },
            },
        });
    });

    test("getIssuerMatchedTransactionInfo (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/internal/issuers/issuerId/users/userId/billing/util/transactions")
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.getIssuerMatchedTransactionInfo("issuerId", "userId", {
                transactionIds: "transactionIds",
            });
        }).rejects.toThrow(KardApi.UnauthorizedError);
    });

    test("getIssuerMatchedTransactionInfo (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/internal/issuers/issuerId/users/userId/billing/util/transactions")
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.getIssuerMatchedTransactionInfo("issuerId", "userId", {
                transactionIds: "transactionIds",
            });
        }).rejects.toThrow(KardApi.InternalServerError);
    });

    test("getIssuerMatchedTransactionInfo (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/internal/issuers/issuerId/users/userId/billing/util/transactions")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.getIssuerMatchedTransactionInfo("issuerId", "userId", {
                transactionIds: "transactionIds",
            });
        }).rejects.toThrow(KardApi.DoesNotExistError);
    });

    test("eomUpdates (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            data: [
                { type: "matchedTransaction", id: "id", attributes: { attributes: { key: "value" } } },
                { type: "matchedTransaction", id: "id", attributes: { attributes: { key: "value" } } },
            ],
        };

        server
            .mockEndpoint()
            .put("/internal/issuers/issuerId/billing/invoice/eom")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.billingAgent.eomUpdates("issuerId", {
            data: [
                {
                    type: "matchedTransaction",
                    id: "id",
                    attributes: {
                        attributes: {
                            key: "value",
                        },
                    },
                },
                {
                    type: "matchedTransaction",
                    id: "id",
                    attributes: {
                        attributes: {
                            key: "value",
                        },
                    },
                },
            ],
        });
        expect(response).toEqual(undefined);
    });

    test("eomUpdates (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            data: [
                { type: "matchedTransaction", id: "id", attributes: { attributes: { key: "value" } } },
                { type: "matchedTransaction", id: "id", attributes: { attributes: { key: "value" } } },
            ],
        };
        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .put("/internal/issuers/issuerId/billing/invoice/eom")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.eomUpdates("issuerId", {
                data: [
                    {
                        type: "matchedTransaction",
                        id: "id",
                        attributes: {
                            attributes: {
                                key: "value",
                            },
                        },
                    },
                    {
                        type: "matchedTransaction",
                        id: "id",
                        attributes: {
                            attributes: {
                                key: "value",
                            },
                        },
                    },
                ],
            });
        }).rejects.toThrow(KardApi.UnauthorizedError);
    });

    test("eomUpdates (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            data: [
                { type: "matchedTransaction", id: "id", attributes: { attributes: { key: "value" } } },
                { type: "matchedTransaction", id: "id", attributes: { attributes: { key: "value" } } },
            ],
        };
        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .put("/internal/issuers/issuerId/billing/invoice/eom")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.eomUpdates("issuerId", {
                data: [
                    {
                        type: "matchedTransaction",
                        id: "id",
                        attributes: {
                            attributes: {
                                key: "value",
                            },
                        },
                    },
                    {
                        type: "matchedTransaction",
                        id: "id",
                        attributes: {
                            attributes: {
                                key: "value",
                            },
                        },
                    },
                ],
            });
        }).rejects.toThrow(KardApi.InternalServerError);
    });

    test("eomUpdates (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = {
            data: [
                { type: "matchedTransaction", id: "id", attributes: { attributes: { key: "value" } } },
                { type: "matchedTransaction", id: "id", attributes: { attributes: { key: "value" } } },
            ],
        };
        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .put("/internal/issuers/issuerId/billing/invoice/eom")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.eomUpdates("issuerId", {
                data: [
                    {
                        type: "matchedTransaction",
                        id: "id",
                        attributes: {
                            attributes: {
                                key: "value",
                            },
                        },
                    },
                    {
                        type: "matchedTransaction",
                        id: "id",
                        attributes: {
                            attributes: {
                                key: "value",
                            },
                        },
                    },
                ],
            });
        }).rejects.toThrow(KardApi.InvalidRequest);
    });

    test("updateMatchedTransaction (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { data: { issuerAmount: 100, cardholderAmount: 100, kardFee: 100 } };

        server
            .mockEndpoint()
            .post(
                "/internal/issuers/5e27318c9b346f00087fbb32/users/5e27318c9b346f00087fbb32/billing/util/transactions/123456",
            )
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.billingAgent.updateMatchedTransaction(
            "5e27318c9b346f00087fbb32",
            "5e27318c9b346f00087fbb32",
            "123456",
            {
                data: {
                    issuerAmount: 100,
                    cardholderAmount: 100,
                    kardFee: 100,
                },
            },
        );
        expect(response).toEqual(undefined);
    });

    test("updateMatchedTransaction (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { data: { issuerAmount: 1, cardholderAmount: 1, kardFee: 1 } };
        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .post("/internal/issuers/issuerId/users/userId/billing/util/transactions/transactionId")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.updateMatchedTransaction("issuerId", "userId", "transactionId", {
                data: {
                    issuerAmount: 1,
                    cardholderAmount: 1,
                    kardFee: 1,
                },
            });
        }).rejects.toThrow(KardApi.UnauthorizedError);
    });

    test("updateMatchedTransaction (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { data: { issuerAmount: 1, cardholderAmount: 1, kardFee: 1 } };
        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .post("/internal/issuers/issuerId/users/userId/billing/util/transactions/transactionId")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.updateMatchedTransaction("issuerId", "userId", "transactionId", {
                data: {
                    issuerAmount: 1,
                    cardholderAmount: 1,
                    kardFee: 1,
                },
            });
        }).rejects.toThrow(KardApi.InternalServerError);
    });

    test("updateMatchedTransaction (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });
        const rawRequestBody = { data: { issuerAmount: 1, cardholderAmount: 1, kardFee: 1 } };
        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .post("/internal/issuers/issuerId/users/userId/billing/util/transactions/transactionId")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.billingAgent.updateMatchedTransaction("issuerId", "userId", "transactionId", {
                data: {
                    issuerAmount: 1,
                    cardholderAmount: 1,
                    kardFee: 1,
                },
            });
        }).rejects.toThrow(KardApi.InvalidRequest);
    });
});
