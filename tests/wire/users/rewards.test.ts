// This file was auto-generated by Fern from our API Definition.

import * as KardApi from "../../../src/api/index";
import { KardApiClient } from "../../../src/Client";
import { mockServerPool } from "../../mock-server/MockServerPool";

describe("RewardsClient", () => {
    test("offers (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            data: [
                {
                    type: "standardOffer",
                    id: "5e27318c9b346f00087fbb5c",
                    attributes: {
                        name: "Worlds Greatest Chicken",
                        terms: "Worlds Greatest Chicken offers are only available within US Locations.",
                        purchaseChannel: ["INSTORE"],
                        userReward: { type: "PERCENT", value: 5.7 },
                        startDate: "2024-11-17T05:00:00Z",
                        expirationDate: "2025-03-17T05:00:00Z",
                        minRewardAmount: { type: "CENTS", value: 500 },
                        maxRewardAmount: { type: "CENTS", value: 2000 },
                        minTransactionAmount: { type: "CENTS", value: 500 },
                        maxTransactionAmount: { type: "CENTS", value: 10000 },
                        maxRedemptions: 1,
                        isTargeted: true,
                        assets: [
                            {
                                type: "LOGO_IMAGE",
                                url: "http://assets.getkard.com/logo/img?attribution-tokens",
                                alt: "Worlds Greatest Chicken Logo Image",
                            },
                            {
                                type: "BANNER_IMAGE",
                                url: "http://assets.getkard.com/banner/img?attribution-tokens",
                                alt: "Worlds Greatest Chicken Banner Image",
                            },
                        ],
                        websiteUrl: "http://worldsgreatestchickent.test.com",
                        description:
                            "Worlds Greatest Chicken brings you the tastiest crispy, double fried spicy chicken in the world.",
                    },
                    relationships: {
                        category: {
                            data: [
                                { type: "category", id: "65920081b524d126068de24a" },
                                { type: "category", id: "65920081b524d126068de24c" },
                            ],
                        },
                    },
                },
            ],
            included: [
                { type: "category", id: "65920081b524d126068de24a", attributes: { name: "Food & Beverage" } },
                { type: "category", id: "65920081b524d126068de24c", attributes: { name: "Department Stores" } },
            ],
            links: {
                self: "/v2/issuers/{organizationId}/users/{userId}/offers?page[size]=1?sort=-startDate",
                next: "/v2/issuers/{organizationId}/users/{userId}/offers?page[after]=NDMyNzQyODI3OTQw&page[size]=1?&sort=-startDate",
            },
        };
        server
            .mockEndpoint()
            .get("/v2/issuers/organization-123/users/user-123/offers")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.users.rewards.offers("organization-123", "user-123", {
            "page[size]": 1,
            "filter[isTargeted]": true,
            sort: "-startDate",
        });
        expect(response).toEqual({
            data: [
                {
                    type: "standardOffer",
                    id: "5e27318c9b346f00087fbb5c",
                    attributes: {
                        name: "Worlds Greatest Chicken",
                        terms: "Worlds Greatest Chicken offers are only available within US Locations.",
                        purchaseChannel: ["INSTORE"],
                        userReward: {
                            type: "PERCENT",
                            value: 5.7,
                        },
                        startDate: "2024-11-17T05:00:00Z",
                        expirationDate: "2025-03-17T05:00:00Z",
                        minRewardAmount: {
                            type: "CENTS",
                            value: 500,
                        },
                        maxRewardAmount: {
                            type: "CENTS",
                            value: 2000,
                        },
                        minTransactionAmount: {
                            type: "CENTS",
                            value: 500,
                        },
                        maxTransactionAmount: {
                            type: "CENTS",
                            value: 10000,
                        },
                        maxRedemptions: 1,
                        isTargeted: true,
                        assets: [
                            {
                                type: "LOGO_IMAGE",
                                url: "http://assets.getkard.com/logo/img?attribution-tokens",
                                alt: "Worlds Greatest Chicken Logo Image",
                            },
                            {
                                type: "BANNER_IMAGE",
                                url: "http://assets.getkard.com/banner/img?attribution-tokens",
                                alt: "Worlds Greatest Chicken Banner Image",
                            },
                        ],
                        websiteUrl: "http://worldsgreatestchickent.test.com",
                        description:
                            "Worlds Greatest Chicken brings you the tastiest crispy, double fried spicy chicken in the world.",
                    },
                    relationships: {
                        category: {
                            data: [
                                {
                                    type: "category",
                                    id: "65920081b524d126068de24a",
                                },
                                {
                                    type: "category",
                                    id: "65920081b524d126068de24c",
                                },
                            ],
                        },
                    },
                },
            ],
            included: [
                {
                    type: "category",
                    id: "65920081b524d126068de24a",
                    attributes: {
                        name: "Food & Beverage",
                    },
                },
                {
                    type: "category",
                    id: "65920081b524d126068de24c",
                    attributes: {
                        name: "Department Stores",
                    },
                },
            ],
            links: {
                self: "/v2/issuers/{organizationId}/users/{userId}/offers?page[size]=1?sort=-startDate",
                next: "/v2/issuers/{organizationId}/users/{userId}/offers?page[after]=NDMyNzQyODI3OTQw&page[size]=1?&sort=-startDate",
            },
        });
    });

    test("offers (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/v2/issuers/organizationId/users/userId/offers")
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.users.rewards.offers("organizationId", "userId");
        }).rejects.toThrow(KardApi.InternalServerError);
    });

    test("offers (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/v2/issuers/organizationId/users/userId/offers")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.users.rewards.offers("organizationId", "userId");
        }).rejects.toThrow(KardApi.InvalidRequest);
    });

    test("offers (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/v2/issuers/organizationId/users/userId/offers")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.users.rewards.offers("organizationId", "userId");
        }).rejects.toThrow(KardApi.DoesNotExistError);
    });

    test("offers (5)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/v2/issuers/organizationId/users/userId/offers")
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.users.rewards.offers("organizationId", "userId");
        }).rejects.toThrow(KardApi.UnauthorizedError);
    });

    test("locations (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            data: [
                {
                    type: "location",
                    id: "5e27318c9b346f00087fba8l",
                    attributes: {
                        name: "Worlds Greatest Chicken",
                        address: { street: "120 Main St", city: "Philadelphia", state: "PA", zipCode: "19147" },
                        coordinates: { longitude: -75.1446869, latitude: 39.9419429 },
                        phone: "+1 (123) 555-8880",
                        operationHours: {
                            periods: [
                                { close: { day: 1, time: "1700" }, open: { day: 1, time: "0900" } },
                                { close: { day: 2, time: "1700" }, open: { day: 2, time: "0900" } },
                                { close: { day: 3, time: "1700" }, open: { day: 3, time: "0900" } },
                                { close: { day: 4, time: "1700" }, open: { day: 4, time: "0900" } },
                                { close: { day: 5, time: "1700" }, open: { day: 5, time: "0900" } },
                            ],
                            weekdayText: [
                                "Monday: 9:00 AM – 5:00 PM",
                                "Tuesday: 9:00 AM – 5:00 PM",
                                "Wednesday: 9:00 AM – 5:00 PM",
                                "Thursday: 9:00 AM – 5:00 PM",
                                "Friday: 9:00 AM – 5:00 PM",
                                "Saturday: Closed",
                                "Sunday: Closed",
                            ],
                        },
                    },
                    relationships: {
                        offers: { data: [{ type: "standardOffer", id: "5e27318c9b346f00087fbb5b" }] },
                        category: { data: [{ type: "category", id: "65920081b524d126068de24a" }] },
                    },
                },
            ],
            included: [
                { type: "category", id: "65920081b524d126068de24a", attributes: { name: "Food & Beverage" } },
                {
                    type: "standardOffer",
                    id: "5e27318c9b346f00087fbb5c",
                    attributes: {
                        name: "Worlds Greatest Chicken",
                        terms: "Worlds Greatest Chicken offers are only available within US Locations.",
                        purchaseChannel: ["INSTORE"],
                        userReward: { type: "PERCENT", value: 5.7 },
                        startDate: "2022-01-01T05:00:00Z",
                        expirationDate: "2022-01-01T05:00:00Z",
                        minRewardAmount: { type: "CENTS", value: 500 },
                        maxRewardAmount: { type: "CENTS", value: 2000 },
                        minTransactionAmount: { type: "CENTS", value: 500 },
                        maxTransactionAmount: { type: "CENTS", value: 2000 },
                        maxRedemptions: 1,
                        isTargeted: true,
                        assets: [
                            {
                                type: "LOGO_IMAGE",
                                url: "http://assets.getkard.com/logo/img?attribution-tokens",
                                alt: "Worlds Greatest Chicken Logo Image",
                            },
                            {
                                type: "BANNER_IMAGE",
                                url: "http://assets.getkard.com/banner/img?attribution-tokens",
                                alt: "Worlds Greatest Chicken Banner Image",
                            },
                        ],
                        websiteUrl: "http://worldsgreatestchickent.test.com",
                        description:
                            "Worlds Greatest Chicken brings you the tastiest crispy, double fried spicy chicken in the world.",
                    },
                },
            ],
            links: {
                self: "/v2/issuers/{organizationId}/users/{userId}/locations?page[size]=1&filter[latitude]=39.9419429&filter[longitude]=-75.1446869&filter[radius]=10&include=offers,categories",
                next: "/v2/issuers/{organizationId}/users/{userId}/locations?page[after]=NDMyNzQyODI3OTQw&page[size]=1&filter[latitude]=39.9419429&filter[longitude]=-75.1446869&filter[radius]=10&include=offers,categories",
            },
        };
        server
            .mockEndpoint()
            .get("/v2/issuers/organization-123/users/user-123/locations")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.users.rewards.locations("organization-123", "user-123", {
            "page[size]": 1,
            "filter[latitude]": 39.9419429,
            "filter[longitude]": -75.1446869,
            "filter[radius]": 10,
            include: "offers,categories",
        });
        expect(response).toEqual({
            data: [
                {
                    type: "location",
                    id: "5e27318c9b346f00087fba8l",
                    attributes: {
                        name: "Worlds Greatest Chicken",
                        address: {
                            street: "120 Main St",
                            city: "Philadelphia",
                            state: "PA",
                            zipCode: "19147",
                        },
                        coordinates: {
                            longitude: -75.1446869,
                            latitude: 39.9419429,
                        },
                        phone: "+1 (123) 555-8880",
                        operationHours: {
                            periods: [
                                {
                                    close: {
                                        day: 1,
                                        time: "1700",
                                    },
                                    open: {
                                        day: 1,
                                        time: "0900",
                                    },
                                },
                                {
                                    close: {
                                        day: 2,
                                        time: "1700",
                                    },
                                    open: {
                                        day: 2,
                                        time: "0900",
                                    },
                                },
                                {
                                    close: {
                                        day: 3,
                                        time: "1700",
                                    },
                                    open: {
                                        day: 3,
                                        time: "0900",
                                    },
                                },
                                {
                                    close: {
                                        day: 4,
                                        time: "1700",
                                    },
                                    open: {
                                        day: 4,
                                        time: "0900",
                                    },
                                },
                                {
                                    close: {
                                        day: 5,
                                        time: "1700",
                                    },
                                    open: {
                                        day: 5,
                                        time: "0900",
                                    },
                                },
                            ],
                            weekdayText: [
                                "Monday: 9:00 AM \u2013 5:00 PM",
                                "Tuesday: 9:00 AM \u2013 5:00 PM",
                                "Wednesday: 9:00 AM \u2013 5:00 PM",
                                "Thursday: 9:00 AM \u2013 5:00 PM",
                                "Friday: 9:00 AM \u2013 5:00 PM",
                                "Saturday: Closed",
                                "Sunday: Closed",
                            ],
                        },
                    },
                    relationships: {
                        offers: {
                            data: [
                                {
                                    type: "standardOffer",
                                    id: "5e27318c9b346f00087fbb5b",
                                },
                            ],
                        },
                        category: {
                            data: [
                                {
                                    type: "category",
                                    id: "65920081b524d126068de24a",
                                },
                            ],
                        },
                    },
                },
            ],
            included: [
                {
                    type: "category",
                    id: "65920081b524d126068de24a",
                    attributes: {
                        name: "Food & Beverage",
                    },
                },
                {
                    type: "standardOffer",
                    id: "5e27318c9b346f00087fbb5c",
                    attributes: {
                        name: "Worlds Greatest Chicken",
                        terms: "Worlds Greatest Chicken offers are only available within US Locations.",
                        purchaseChannel: ["INSTORE"],
                        userReward: {
                            type: "PERCENT",
                            value: 5.7,
                        },
                        startDate: "2022-01-01T05:00:00Z",
                        expirationDate: "2022-01-01T05:00:00Z",
                        minRewardAmount: {
                            type: "CENTS",
                            value: 500,
                        },
                        maxRewardAmount: {
                            type: "CENTS",
                            value: 2000,
                        },
                        minTransactionAmount: {
                            type: "CENTS",
                            value: 500,
                        },
                        maxTransactionAmount: {
                            type: "CENTS",
                            value: 2000,
                        },
                        maxRedemptions: 1,
                        isTargeted: true,
                        assets: [
                            {
                                type: "LOGO_IMAGE",
                                url: "http://assets.getkard.com/logo/img?attribution-tokens",
                                alt: "Worlds Greatest Chicken Logo Image",
                            },
                            {
                                type: "BANNER_IMAGE",
                                url: "http://assets.getkard.com/banner/img?attribution-tokens",
                                alt: "Worlds Greatest Chicken Banner Image",
                            },
                        ],
                        websiteUrl: "http://worldsgreatestchickent.test.com",
                        description:
                            "Worlds Greatest Chicken brings you the tastiest crispy, double fried spicy chicken in the world.",
                    },
                },
            ],
            links: {
                self: "/v2/issuers/{organizationId}/users/{userId}/locations?page[size]=1&filter[latitude]=39.9419429&filter[longitude]=-75.1446869&filter[radius]=10&include=offers,categories",
                next: "/v2/issuers/{organizationId}/users/{userId}/locations?page[after]=NDMyNzQyODI3OTQw&page[size]=1&filter[latitude]=39.9419429&filter[longitude]=-75.1446869&filter[radius]=10&include=offers,categories",
            },
        });
    });

    test("locations (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/v2/issuers/organizationId/users/userId/locations")
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.users.rewards.locations("organizationId", "userId");
        }).rejects.toThrow(KardApi.InternalServerError);
    });

    test("locations (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/v2/issuers/organizationId/users/userId/locations")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.users.rewards.locations("organizationId", "userId");
        }).rejects.toThrow(KardApi.InvalidRequest);
    });

    test("locations (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/v2/issuers/organizationId/users/userId/locations")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.users.rewards.locations("organizationId", "userId");
        }).rejects.toThrow(KardApi.DoesNotExistError);
    });

    test("locations (5)", async () => {
        const server = mockServerPool.createServer();
        const client = new KardApiClient({ maxRetries: 0, token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            errors: [
                { status: "status", title: "title", detail: "detail" },
                { status: "status", title: "title", detail: "detail" },
            ],
        };
        server
            .mockEndpoint()
            .get("/v2/issuers/organizationId/users/userId/locations")
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.users.rewards.locations("organizationId", "userId");
        }).rejects.toThrow(KardApi.UnauthorizedError);
    });
});
